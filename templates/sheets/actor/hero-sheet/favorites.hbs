{{#*inline "kitDamageBonuses"}}
{{#if (or damage.tier1 damage.tier2 damage.tier3)}}
{{numberFormat damage.tier1 sign=true}} / {{numberFormat damage.tier2 sign=true}} / {{numberFormat damage.tier3 sign=true}}
{{/if}}
{{/inline}}

<section class="tab favorites {{tab.cssClass}}" data-group="primary" data-tab="favorites">
  {{#unless hasFavorites}}
  <div class="dsp-favorites-empty">
    <p>{{localize "DRAW_STEEL_PLUS.Favorites.Empty"}}</p>
  </div>
  {{else}}
  {{#each favAbilities as |abilityType|}}
  {{#if abilityType.showHeader}}
  <section class="item-list-container">
    <div class="item-header">
      <div class="item-column item-name">{{abilityType.label}}</div>
      {{#if (eq @key "villain")}}
      <div class="item-column item-order">{{localize "DRAW_STEEL.Item.ability.Order"}}</div>
      {{else}}
      <div class="item-column item-cost">{{abilityFields.resource.label}}</div>
      {{/if}}
      <div class="item-column item-distance">{{abilityFields.distance.label}}</div>
      <div class="item-column item-target">{{abilityFields.target.label}}</div>
      <div class="item-column item-controls"></div>
    </div>
    <ol class="item-list abilities-list">
      {{#each abilityType.abilities as |abilityContext|}}
      <li class="item ability draggable expandable-document" data-document-uuid="{{abilityContext.item.uuid}}">
        <div class="item-row">
          <div class="item-column item-name item-tooltip">
            <div class="item-image-wrapper" data-action="useAbility">
              <img class="item-image" src="{{abilityContext.item.img}}" alt="{{abilityContext.item.name}}">
            </div>
            {{#if abilityContext.item.system.restricted}}
            <div class="restricted-warning" data-tooltip="DRAW_STEEL.Item.ability.Restricted">
              <i class="fa-solid fa-triangle-exclamation"></i>
            </div>
            {{/if}}
            <div class="name" data-action="toggleDocumentDescription">
              <div class="label">{{abilityContext.item.name}}</div>
              <div class="keywords">{{abilityContext.formattedLabels.keywords}}</div>
            </div>
          </div>
          {{#if (eq @../key "villain")}}
          <div class="item-column item-order">{{abilityContext.order}}</div>
          {{else}}
          <div class="item-column item-cost">
            {{#if abilityContext.item.system.resource}}
            {{abilityContext.item.system.resource}} {{@root.system.coreResource.name}}
            {{/if}}
          </div>
          {{/if}}
          <div class="item-column item-distance">{{abilityContext.formattedLabels.distance}}</div>
          <div class="item-column item-target">{{abilityContext.formattedLabels.target}}</div>
          <div class="item-column item-controls">
            <a class="fa-fw fa-solid fa-play" data-action="useAbility"></a>
            <a class="fa-fw fa-solid fa-comment" data-action="documentListShare"></a>
            <a class="dsp-favorite-btn dsp-favorited" data-action="toggleFavorite" data-tooltip="DRAW_STEEL_PLUS.Favorites.Unfavorite"><i class="fa-solid fa-star"></i></a>
            <a class="fa-fw fa-solid fa-ellipsis-vertical" data-action="documentListContext"></a>
            <a class="fa-fw fa-solid fa-angle-{{ifThen abilityContext.expanded "down" "right"}}" data-action="toggleDocumentDescription"></a>
          </div>
        </div>
        <div class="document-description item-embed content-embed {{#if abilityContext.expanded}}expanded{{/if}}">
          {{#if abilityContext.expanded}}{{{abilityContext.embed.outerHTML}}}{{/if}}
        </div>
      </li>
      {{/each}}
    </ol>
  </section>
  {{/if}}
  {{/each}}

  {{#if favFeatures.length}}
  <section class="item-list-container feature-list-container">
    <div class="item-header">
      <div class="item-column item-name">{{localize "TYPES.Item.feature"}}</div>
      <div class="item-column item-type">{{localize "DOCUMENT.FIELDS.type.label"}}</div>
      <div class="item-column item-controls"></div>
    </div>
    <ol class="item-list feature-list">
      {{#each favFeatures as |featureContext|}}
      <li class="item feature draggable expandable-document" data-document-uuid="{{featureContext.item.uuid}}">
        <div class="item-row">
          <div class="item-column item-name item-tooltip">
            <div class="item-image-wrapper chat-overlay" data-action="documentListShare">
              <img class="item-image" src="{{featureContext.item.img}}" alt="{{featureContext.item.name}}">
            </div>
            <div class="name" data-action="toggleDocumentDescription">
              <div class="label">{{featureContext.item.name}}</div>
            </div>
          </div>
          <div class="item-column item-type">{{localize featureContext.typeLabel}}</div>
          <div class="item-column item-controls">
            <a class="fa-fw fa-solid fa-comment" data-action="documentListShare"></a>
            <a class="dsp-favorite-btn dsp-favorited" data-action="toggleFavorite" data-tooltip="DRAW_STEEL_PLUS.Favorites.Unfavorite"><i class="fa-solid fa-star"></i></a>
            <a class="fa-fw fa-solid fa-ellipsis-vertical" data-action="documentListContext"></a>
            <a class="fa-fw fa-solid fa-angle-{{ifThen featureContext.expanded "down" "right"}}" data-action="toggleDocumentDescription"></a>
          </div>
        </div>
        <div class="document-description item-embed {{#if featureContext.expanded}}expanded{{/if}}">
          {{#if featureContext.expanded}}{{{featureContext.embed.outerHTML}}}{{/if}}
        </div>
      </li>
      {{/each}}
    </ol>
  </section>
  {{/if}}

  {{#if favComplications.length}}
  <section class="item-list-container complications-list-container">
    <div class="item-header">
      <div class="item-column item-name">{{favComplicationsLabel}}</div>
      <div class="item-column item-controls"></div>
    </div>
    <ol class="item-list complications-list">
      {{#each favComplications as |complicationContext|}}
      <li class="item complication draggable expandable-document" data-document-uuid="{{complicationContext.item.uuid}}">
        <div class="item-row">
          <div class="item-column item-name item-tooltip">
            <div class="item-image-wrapper chat-overlay" data-action="documentListShare">
              <img class="item-image" src="{{complicationContext.item.img}}" alt="{{complicationContext.item.name}}">
            </div>
            <div class="name" data-action="toggleDocumentDescription">
              <div class="label">{{complicationContext.item.name}}</div>
            </div>
          </div>
          <div class="item-column item-controls">
            <a class="fa-fw fa-solid fa-comment" data-action="documentListShare"></a>
            <a class="dsp-favorite-btn dsp-favorited" data-action="toggleFavorite" data-tooltip="DRAW_STEEL_PLUS.Favorites.Unfavorite"><i class="fa-solid fa-star"></i></a>
            <a class="fa-fw fa-solid fa-ellipsis-vertical" data-action="documentListContext"></a>
            <a class="fa-fw fa-solid fa-angle-{{ifThen complicationContext.expanded "down" "right"}}" data-action="toggleDocumentDescription"></a>
          </div>
        </div>
        <div class="document-description item-embed {{#if complicationContext.expanded}}expanded{{/if}}">
          {{#if complicationContext.expanded}}{{{complicationContext.embed.outerHTML}}}{{/if}}
        </div>
      </li>
      {{/each}}
    </ol>
  </section>
  {{/if}}

  {{#if favKits.length}}
  <section class="item-list-container kit-list-container">
    <div class="item-header">
      <div class="item-column item-name">{{localize "TYPES.Item.kit"}}</div>
      <div class="item-column item-melee-bonus">{{kitFields.bonuses.fields.melee.fields.damage.label}}</div>
      <div class="item-column item-ranged-bonus">{{kitFields.bonuses.fields.ranged.fields.damage.label}}</div>
      <div class="item-column item-controls"></div>
    </div>
    <ol class="item-list kit-list">
      {{#each favKits as |kitContext|}}
      <li class="item feature draggable expandable-document" data-document-uuid="{{kitContext.item.uuid}}">
        <div class="item-row">
          <div class="item-column item-name item-tooltip">
            <div class="item-image-wrapper chat-overlay" data-action="documentListShare">
              <img class="item-image" src="{{kitContext.item.img}}" alt="{{kitContext.item.name}}">
            </div>
            {{#if (eq @root.system.hero.preferredKit kitContext.item.id)}}
            <i data-tooltip="DRAW_STEEL.Item.kit.PreferredKit.Label" class="fa-solid fa-star"></i>
            {{/if}}
            <div class="name" data-action="toggleDocumentDescription">
              <div class="label">{{kitContext.item.name}}</div>
            </div>
          </div>
          <div class="item-column item-melee-bonus">{{> kitDamageBonuses damage=kitContext.item.system.bonuses.melee.damage}}</div>
          <div class="item-column item-ranged-bonus">{{> kitDamageBonuses damage=kitContext.item.system.bonuses.ranged.damage}}</div>
          <div class="item-column item-controls">
            <a class="fa-fw fa-solid fa-comment" data-action="documentListShare"></a>
            <a class="dsp-favorite-btn dsp-favorited" data-action="toggleFavorite" data-tooltip="DRAW_STEEL_PLUS.Favorites.Unfavorite"><i class="fa-solid fa-star"></i></a>
            <a class="fa-fw fa-solid fa-ellipsis-vertical" data-action="documentListContext"></a>
            <a class="fa-fw fa-solid fa-angle-{{ifThen kitContext.expanded "down" "right"}}" data-action="toggleDocumentDescription"></a>
          </div>
        </div>
        <div class="document-description item-embed {{#if kitContext.expanded}}expanded{{/if}}">
          {{#if kitContext.expanded}}{{{kitContext.embed.outerHTML}}}{{/if}}
        </div>
      </li>
      {{/each}}
    </ol>
  </section>
  {{/if}}

  {{#each favTreasure as |treasureType|}}
  <section class="item-list-container treasure-list-container">
    <div class="item-header">
      <div class="item-column item-name">{{treasureType.label}}</div>
      <div class="item-column item-echelon">{{treasureFields.echelon.label}}</div>
      <div class="item-column item-quantity">{{treasureFields.quantity.label}}</div>
      <div class="item-column item-controls"></div>
    </div>
    <ol class="item-list treasure-list">
      {{#each treasureType.treasure as |treasureContext|}}
      <li class="item treasure draggable expandable-document" data-document-uuid="{{treasureContext.item.uuid}}">
        <div class="item-row">
          <div class="item-column item-name item-tooltip">
            <div class="item-image-wrapper chat-overlay" data-action="documentListShare">
              <img class="item-image" src="{{treasureContext.item.img}}" alt="{{treasureContext.item.name}}">
            </div>
            <div class="name" data-action="toggleDocumentDescription">
              <div class="label">{{treasureContext.item.name}}</div>
            </div>
          </div>
          <div class="item-column item-echelon">{{localize (concat "DRAW_STEEL.ECHELON." treasureContext.item.system.echelon)}}</div>
          <div class="item-column item-quantity quantity-controls">
            <a data-action="modifyItemQuantity" data-quantity-modification="decrease">
              <i class="fa-regular fa-minus"></i>
            </a>
            <span class="quantity">{{treasureContext.item.system.quantity}}</span>
            <a data-action="modifyItemQuantity" data-quantity-modification="increase">
              <i class="fa-regular fa-plus"></i>
            </a>
          </div>
          <div class="item-column item-controls">
            <a class="fa-fw fa-solid fa-comment" data-action="documentListShare"></a>
            <a class="dsp-favorite-btn dsp-favorited" data-action="toggleFavorite" data-tooltip="DRAW_STEEL_PLUS.Favorites.Unfavorite"><i class="fa-solid fa-star"></i></a>
            <a class="fa-fw fa-solid fa-angle-{{ifThen treasureContext.expanded "down" "right"}}" data-action="toggleDocumentDescription"></a>
          </div>
        </div>
        <div class="document-description item-embed {{#if treasureContext.expanded}}expanded{{/if}}">
          {{#if treasureContext.expanded}}{{{treasureContext.embed.outerHTML}}}{{/if}}
        </div>
      </li>
      {{/each}}
    </ol>
  </section>
  {{/each}}

  {{#if favProjects.length}}
  <section class="item-list-container project-list-container">
    <div class="item-header">
      <div class="item-column item-name">{{localize "TYPES.Item.project"}}</div>
      <div class="item-column item-points">{{projectFields.points.label}}</div>
      <div class="item-column item-type">{{projectFields.type.label}}</div>
      <div class="item-column item-controls"></div>
    </div>
    <ol class="item-list project-list">
      {{#each favProjects as |projectContext|}}
      <li class="item project draggable expandable-document" data-document-uuid="{{projectContext.item.uuid}}">
        <div class="item-row">
          <div class="item-column item-name item-tooltip">
            <div class="item-image-wrapper" data-action="rollProject">
              <img class="item-image" src="{{projectContext.item.img}}" alt="{{projectContext.item.name}}">
            </div>
            <div class="name" data-action="toggleDocumentDescription">
              <div class="label">{{projectContext.item.name}}</div>
            </div>
          </div>
          <div class="item-column item-points">{{ifThen projectContext.item.system.points projectContext.item.system.points "0"}} / {{ifThen projectContext.item.system.goal projectContext.item.system.goal (localize "DRAW_STEEL.Item.project.Varies")}}</div>
          <div class="item-column item-type">{{lookup (lookup @root.config.projects.types projectContext.item.system.type) "label"}}</div>
          <div class="item-column item-controls">
            <a class="fa-fw fa-solid fa-play" data-action="rollProject"></a>
            <a class="fa-fw fa-solid fa-comment" data-action="documentListShare"></a>
            <a class="dsp-favorite-btn dsp-favorited" data-action="toggleFavorite" data-tooltip="DRAW_STEEL_PLUS.Favorites.Unfavorite"><i class="fa-solid fa-star"></i></a>
            <a class="fa-fw fa-solid fa-ellipsis-vertical" data-action="documentListContext"></a>
            <a class="fa-fw fa-solid fa-angle-{{ifThen projectContext.expanded "down" "right"}}" data-action="toggleDocumentDescription"></a>
          </div>
        </div>
        <div class="document-description item-embed {{#if projectContext.expanded}}expanded{{/if}}">
          {{#if projectContext.expanded}}{{{projectContext.embed.outerHTML}}}{{/if}}
        </div>
      </li>
      {{/each}}
    </ol>
  </section>
  {{/if}}
  {{/unless}}
</section>
